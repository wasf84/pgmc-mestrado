\chapter{PROCEDIMENTOS METODOLÓGICOS}
\section{Descrição da Área de Estudo}
%Detalhar a localização e características da minha área de estudo.

\todo[inline]{FAZER IMAGEM DAS BACIAS}

As bacias de estudo são as bacias dos rios Jequitinhonha, Doce, Grande e São Francisco. Em todas estas, o corpo d'água principal da bacia, seus respectivos rios, passam dentro do estado de Minas Gerais, por isso a escolha. Isso é para distinguir do não uso do rio Paraíba do Sul no estudo, visto que parte de sua bacia está nos limites do estado, mas o rio não passa dentro dos limites administrativos estaduais.

O rio Jequitinhonha, com sua bacia hidrográfica abrangendo cerca de 65 mil quilômetros quadrados, é uma peça fundamental na paisagem e na vida socioeconômica de Minas Gerais. Seu curso percorre 82 municípios mineiros, abrigando uma população de aproximadamente 939 mil habitantes que dependem diretamente de suas águas.\cite{ibge} \cite{jequiti_igam_mg_1} \cite{jequiti_igam_mg_2} \cite{jequiti_igam_mg_3}

A Mata Atlântica é o bioma predominante e a atividade econômica principal na região é a agropecuária, ocupando uma área considerável de 2,6 milhões de hectares, em contraste com os 3,8 milhões de hectares de floresta. Essa dinâmica evidencia a pressão exercida sobre o ecossistema, demandando um olhar atento para a gestão sustentável dos recursos naturais.\cite{mapbiomas}

O rio Doce, com sua nascente na Serra da Mantiqueira, em Minas Gerais, percorre 853 quilômetros até desaguar no Oceano Atlântico, no Espírito Santo, delineando uma bacia hidrográfica muito importante para o Sudeste brasileiro. Com uma área de drenagem de 86 mil quilômetros quadrados, abriga 200 municípios mineiros, onde residem cerca de 3,5 milhões de pessoas, e desempenha um papel crucial na dinâmica socioeconômica e ambiental da região. 

A predominância da Mata Atlântica, com uma pequena fração de Cerrado, confere à bacia uma vasta biodiversidade, ao mesmo tempo em que a coloca em posição de vulnerabilidade frente às pressões antrópicas. As principais atividades ecônomicas são a agropecuária, a agroindústria e o setor de mineração/siderurgia (Quadrilátero Ferrífero) e impulsionam a economia regional. A cobertura do solo, com 2,4 milhões de hectares de floresta e 5,5 milhões de hectares dedicados à agropecuária, reflete essa dualidade entre desenvolvimento e preservação.

O rio Grande é um dos cursos d'água mais importantes do Brasil, escorrendo por Minas Gerais e São Paulo até se unir ao rio Paranaíba e formar o rio Paraná. Com uma área de drenagem de 143 mil quilômetros quadrados, sua bacia abrange 393 municípios, impactando a vida de cerca de 9 milhões de pessoas. 

Nascido na Serra da Mantiqueira, o rio Grande é um rio de planalto, percorrendo 1286 km até seu encontro com o Paranaíba. O Cerrado é o bioma predominante em sua bacia, com trechos que se limitam à Mata Atlântica, criando uma rica diversidade de ecossistemas.

A agroindústria é a principal atividade econômica na região, impulsionada pela fertilidade do solo e pela disponibilidade de água. No entanto, o rio Grande também é fundamental para a geração de energia elétrica, abrigando 13 barragens, incluindo a importante usina de Furnas. Essa combinação de agropecuária e geração de energia molda a paisagem da bacia, com 11,1 milhões de hectares dedicados à agricultura e 2,1 milhões de hectares cobertos por florestas.

Por fim, mas certamente, não menos importante, rio São Francisco. Carinhosamente apelidado de ``Velho Chico'', conecta regiões, culturas e economias ao longo de seus quase 3 mil quilômetros de extensão. Com uma bacia hidrográfica que abrange 639 mil quilômetros quadrados, a bacia do São Francisco corresponde a 8\% do território nacional, impactando diretamente a vida de cerca de 15 milhões de pessoas.

Sua grandiosidade é tamanha que sua bacia abrange seis estados brasileiros - Minas Gerais, Goiás, Bahia, Pernambuco, Alagoas e Sergipe - e devido à tanta complexidade, a bacia é dividida em quatro regiões fisiográficas distintas: Alto, Médio, Submédio e Baixo São Francisco, cada qual com particularidades geográficas, sociais e econômicas.

A diversidade de biomas que o Velho Chico atravessa é outro ponto marcante: do Cerrado à Caatinga, passando por fragmentos da Mata Atlântica, essa variedade se reflete também na cobertura do solo de sua bacia, com predominância de áreas destinadas à agropecuária (12,4 milhões de hectares) e florestas (15,3 milhões de hectares), indicando a importância tanto da produção agrícola quanto da preservação ambiental. Suas águas impulsionam atividades como a siderurgia, mineração, indústria química e têxtil, além de pesca e agropecuária.

%O rio São Francisco é também um fenômeno cultural. Diversos poetas, cantores e escritores já escreveram sobre suas águas. Estudá-lo e compreendê-lo é também ajudar a manter viva sua poesia.

\section{Dados Utilizados}
\todo[inline]{FAZER IMAGEM DE ONDE ESTÃO AS ESTAÇÕES}

A coleta dos dados foi realizada com um misto da biblioteca HydroBR \cite{carvalho2020hydrobr} e funções próprias de extração de dados. A biblioteca permitiu a listagem de todas as estações hidrométricas disponíveis, como, por exemplo, as estações convencionais de medição de vazão. Após a identificação e seleção das estações de interesse, cujos códigos estavam disponíveis na base de dados da ANA, desenvolveu-se um conjunto de funções para automatizar o processo de extração. Essas funções permitiram o \textit{download} dos dados referentes ao período especificado diretamente do \textit{webservice} fornecido pela ANA.

O período de dados analisado compreende \textbf{de 1º de janeiro de 2013 a 31 de dezembro de 2023}, totalizando 11 anos completos.

Foram utilizadas \textbf{séries temporais diárias} de precipitação e vazão. As colunas correspondentes às datas foram formatadas como ``\textit{datetime}'', enquanto os dados de precipitação e vazão foram representados como valores de ponto flutuante (``\textit{float}''). Embora a frequência diária tenha sido adotada, é importante destacar que nem todas as séries temporais estavam originalmente nesse formato. Foi necessário lidar com quebra na continuidade das datas e com dados ausentes. Estes aspectos serão discutidos em detalhes em seções subsequentes.

Os dados de precipitação e vazão obtidos do site da ANA já estavam ajustados nas escalas padrão utilizadas em estudos hidrológicos. A precipitação foi fornecida em milímetros por dia (mm/dia), refletindo a quantidade de chuva que cai sobre uma unidade de área em um período de 24 horas e as vazões, por sua vez, foram disponibilizadas em metros cúbicos por segundo (m³/s), indicando o volume de água que passa por uma seção transversal do rio a cada segundo. Em algumas estações, foram observados valores extremamente elevados para determinados dias, tanto nas séries de precipitação quanto nas de vazão, os quais podem ser considerados \textit{outliers}. Em relação aos dados de vazão, verificou-se a ocorrência de valores nulos (vazão igual a 0), o que indicaria a interrupção completa do fluxo do rio. Esse fenômeno, no entanto, não faz sentido, considerando que não há registro de eventos de seca tão severos nos rios analisados. Apesar destas anomalias, os dados não foram descartados, pois tanto os registros de vazão quanto os de precipitação utilizados nesta pesquisa foram considerados consistidos pela ANA, ou seja, foram medidos e validados pela agência. O presente trabalho não questionou a veracidade dos dados; eles foram utilizados conforme disponibilizados pela ANA.

É relevante destacar que a consulta prévia ao sistema \textit{on-line} da ANA foi essencial, pois frequentemente selecionavam-se códigos de estação que, ao final, não possuíam dados para o período especificado ou apresentavam códigos alterados na base de dados, sendo retornados como ``inexistentes''. Quando um código de estação não retornava resultados na consulta ao sistema, foi necessário utilizar o sistema gentilmente cedido pela Rhama Analysis para verificar se o código da estação havia sido modificado. Nos casos em que se constatava a alteração, o novo código foi adotado, enquanto o código anteriormente informado como inexistente foi descartado.

Em cada rio analisado, a estação alvo, com a vazão que se pretendia prever, foram destacadas em itálico para ficar claro ao leitor como identificá-las.

A distinção entre estação convencional e telemétrica deve-se a esta ter informações a cada quinze minutos, a cada trinta minutos ou ser do tipo horária. Onde ocorreu de ter informações tão granuladas assim, para a precipitação foi feito o somatório para um dia e a vazão foi a média de um dia.

Por fim, é importante destacar a existência de estações híbridas, classificadas como ``pluviométricas/fluviométricas''. Em alguns casos, o código da estação pode indicar que se trata de uma estação de vazão (com códigos iniciados em 5 ou 6, por exemplo), mas que também possui informações de precipitação. O inverso também ocorre, onde códigos indicam estações pluviométricas (com códigos iniciados em 016 ou 019, por exemplo) que, no entanto, contêm dados de vazão. Para garantir a consistência com a nomenclatura utilizada pela ANA, manteve-se a classificação original das estações, mesmo que estas contenham apenas dados de precipitação ou vazão.

Para facilitar a visualização, as estações de vazão e precipitação utilizadas no trabalho são apresentadas abaixo. 

\begin{table}[!h]
	\centering \small
	\caption{Estações usadas no rio Jequitinhonha \\(fonte: o autor)}
	\begin{tabular}{|c|c|c|c|c|} \hline 
		\multicolumn{5}{|c|}{\textbf{Telemétricas}}\\\hline
		\multicolumn{5}{|c|}{\textbf{Pluviométricas/Fluviométricas}}\\\hline
		\textbf{Código}   & \textbf{Nome}                                 & \textbf{Município}       & \textbf{Latitude} & \textbf{Longitude}\\\hline
		\textit{54790000} & \textit{\makecell{UHE Itapebi \\ montante 1}} & \textit{Salto da Divisa} & \textit{-16,08}   & \textit{-40,0521}\\\hline
		01640000          & Jacinto                                       & Jacinto                  & -16,1386          & -40,2903\\\hline
	\end{tabular}
	\label{tab:estacoes_jequitinhonha}
\end{table}

\begin{table}[!h]
	\centering \small
	\caption{Estações usadas no rio Doce \\(fonte: o autor)}
	\begin{tabular}{|c|c|c|c|c|} \hline 
		\multicolumn{5}{|c|}{\textbf{Convencionais}}\\ \hline 
		\multicolumn{5}{|c|}{\textbf{Pluviométricas}}\\ \hline
		\textbf{Código} & \textbf{Nome}                               & \textbf{Município} & \textbf{Latitude} & \textbf{Longitude}\\\hline
		01941010        & \makecell{São Sebastião \\ da Encruzilhada} & Aimorés            & -19,4925          & -41,1617 \\\hline
		01941004        & \makecell{Resplendor - jusante}             & Resplendor         & -19,3431          & -41,2461 \\\hline
		01941006        & \makecell{Assarai - montante}               & Pocrane            & -19,5947          & -41,4581 \\\hline
		\multicolumn{5}{|c|}{}\\\hline
		\multicolumn{5}{|c|}{\textbf{Telemétricas}}\\\hline
		\multicolumn{5}{|c|}{\textbf{Pluviométricas/Fluviométricas}}\\\hline
		\textbf{Código}   & \textbf{Nome}                          & \textbf{Município} & \textbf{Latitude} & \textbf{Longitude}\\\hline
		56990005          & \makecell{UHE Aimorés \\ rio Manhuaçu} & Aimorés            & -19,4917          & -41,1614 \\\hline 
		\textit{56994500} & \textit{\makecell{Colatina ponte}}     & \textit{Colatina}  & \textit{-19,5333} & \textit{-40,6297} \\\hline
	\end{tabular}
	\label{tab:estacoes_rio_doce}
\end{table}

\begin{table}[!h]
	\centering \small
	\caption{Estações usadas no rio Grande \\(fonte: o autor)}
	\begin{tabular}{|c|c|c|c|c|} \hline 
		\multicolumn{5}{|c|}{\textbf{Telemétricas}}\\\hline
		\multicolumn{5}{|c|}{\textbf{Fluviométricas}}\\\hline
		\textbf{Código}   & \textbf{Nome}                                       & \textbf{Município}     & \textbf{Latitude} & \textbf{Longitude}\\\hline
		\textit{62020080} & \textit{\makecell{UHE Ilha Solteira \\ barramento}} & \textit{Ilha Solteira} & \textit{-20,3797} & \textit{-51,3686} \\\hline 
		\multicolumn{5}{|c|}{\textbf{Pluviométricas/Fluviométricas}}\\ \hline
		\textbf{Código} & \textbf{Nome}                              & \textbf{Município} & \textbf{Latitude} & \textbf{Longitude}\\\hline
		61998080        & \makecell{UHE Água Vermelha\\ barramento} & Ouroeste           & -19,8628          & -50,3475 \\\hline
	\end{tabular}
	\label{tab:estacoes_rio_grande}
\end{table}

\begin{table}[!h]
	\centering \small
	\caption{Estações usadas no rio São Francisco \\(fonte: o autor)}
	\begin{tabular}{|c|c|c|c|c|} \hline 
		\multicolumn{5}{|c|}{\textbf{Convencionais}}\\ \hline 
		\multicolumn{5}{|c|}{\textbf{Fluviométricas}}\\ \hline
		\textbf{Código}   & \textbf{Nome}                                 & \textbf{Município}                            & \textbf{Latitude} & \textbf{Longitude}\\\hline
		\textit{44290002} & \textit{\makecell{Pedras de Maria\\ da Cruz}} & \textit{\makecell{Pedras de Maria\\ da Cruz}} & \textit{-15,6011} & \textit{-44,3967} \\\hline
		\multicolumn{5}{|c|}{\textbf{Pluviométricas/Fluviométricas}}\\ \hline
		\textbf{Código} & \textbf{Nome}                            & \textbf{Município} & \textbf{Latitude} & \textbf{Longitude}\\\hline
		01544017        & \makecell{Pedras de Maria\\ da Cruz}     & Januária           & -15,5978          & -44,3903 \\\hline
		01544032        & \makecell{Usina do Pandeiros\\ montante} & Januária           & -15,4831          & -44,7672 \\\hline
		01544036        & \makecell{Lontra}                        & Lontra             & -15,9056          & -44,3072 \\\hline
	\end{tabular}
	\label{tab:estacoes_rio_sao_francisco}
\end{table}
\clearpage

É importante destacar algumas observações sobre as estações do rio Grande. Durante o período pesquisado, apenas foram encontrados dados de precipitação e vazão em estações localizadas no estado de São Paulo. As estações utilizadas para o rio Grande, as mais próximas da foz do rio e próximas à divisa com o estado de Minas Gerais, são aquelas listadas na tabela.

Uma situação semelhante ocorreu com o rio Doce. Não foram encontradas estações com dados disponíveis na foz do rio Doce, localizada no estado de Minas Gerais. Portanto, foi necessário utilizar a estação 56994500, situada no estado do Espírito Santo.

Estas são as únicas observações relevantes sobre as estações utilizadas.

\section{Pré-processamento dos Dados}
% Descrever os passos tomados para preparar os dados para análise (imputação de dados faltantes, gráficos de sazonalidade, etc...).

Com os dados disponíveis localmente, o primeiro passo antes de qualquer análise foi garantir a continuidade temporal dos mesmos. Existiam dias faltantes, e, para garantir uma linha do tempo contínua, foi necessário preencher essas lacunas. Os 11 anos de dados diários resultaram em um total de 4017 linhas de dados após essa etapa.

A sazonalidade é um fenômeno bem conhecido e estabelecido na análise hidrológica das bacias hidrográficas da América do Sul. O aumento da precipitação começa na primavera, em setembro, e atinge seus picos nos meses de dezembro e janeiro, durante o verão. Consequentemente, as vazões dos rios aumentam. Com a chegada do outono e, posteriormente, do inverno, os índices pluviométricos diminuem, assim como as vazões nos rios. \cite{rayyan-39677094}

Considerando esse fenômeno, o preenchimento dos dados faltantes foi realizado replicando o padrão sazonal. Para preencher um dia faltante em julho, por exemplo, foi utilizado o valor correspondente ao mesmo dia nos anos anteriores. Para evitar a repetição exata do ano anterior, utilizou-se a média dos últimos três anos. As funções desenvolvidas para essa finalidade são personalizáveis, permitindo que se opte por repetir exatamente o ano anterior ou considerar mais de três anos, dependendo das necessidades do estudo. 

Note que a estratégia de realizar a média, para o dia, dos anos anteriores nem sempre preenchia exatamente as lacunas. Quando havia muitos dados faltantes no início da série, por exemplo, isso causava problema e a inserção de dados falhava. O que é o comportamento normal.

Foi então que realizou-se uma nova contagem dos dados que ainda permaneciam faltantes. Para esses casos nulos, foi aplicada a imputação de dados utilizando o modelo kNN (k-Nearest Neighbors - k-vizinhos mais próximos), com o objetivo de garantir uma melhor dispersão dos valores imputados. O modelo kNN operou calculando a distância euclidiana dos pontos nulos \underline{utilizando os sete vizinhos mais próximos}, atribuindo maior peso aos vizinhos mais próximos no cálculo. Esse método de imputação visou preservar a tendência local e o comportamento da série temporal dentro da semana em que o dado faltante estava. Após esta nova fase de imputação dos dados as séries ficaram completamente preenchidas.

É muito importante o destaque para esta fase de preenchimento de dados faltantes, e os desafios que isso apresentou ao trabalho, porque a escassez de informação foi um problema. Quando o período faltante era curto, o comportamento da série temporal preservou coerentemente os padrões sazonais, de tendência e estacionariedade. Contudo, mais especificamente para o rio Grande, isso tudo ainda não foi suficiente. A série temporal de vazão não preservou o comportamento sazonal esperado, ficando com muitos ruídos.

Neste momento cabe explicar uma nomenclatura utilizada no trabalho para rapidamente identificar o tipo de estação, se convencional ou telemétrica, de que dado ela trata (chuva ou vazão) e o código da estação. Tomemos dois exemplos que serão vistos nesta seção. Esta é a estação `c\_cv\_01941010', utilizada na análise do rio Doce. A letra `c' designa `convencional' e as letras `cv' significam `chuva', consequentemente, a sequência numérica é o código da estação em questão. A mesma analogia serve para as estações telemétricas. O nome `t\_vz\_54790000' significa `estação telemétrica de vazão, código 54790000'.

\subsection{Rio Jequitinhonha}

A estação de vazão utilizada no rio Jequitinhonha apresentou uma quantidade significativa de dados faltantes, especialmente no início da série temporal. Observa-se uma clara sazonalidade na série, com picos de vazão ocorrendo predominantemente no final e início de cada ano (figura \ref{fig:jequitinhonhaSerieIncompleta_t_vz_54790000}).
As figuras (\ref{fig:jequitinhonhaSerieIncompleta_t_vz_54790000}), (\ref{fig:jequitinhonhaSerieCompleta_t_vz_54790000}), (\ref{fig:jequitinhonhaSerieIncompleta_t_vz_54790000-2013_2016}), (\ref{fig:jequitinhonhaSerieCompleta_t_vz_54790000-2013_2016}), (\ref{fig:jequitinhonhaSerieIncompleta_t_vz_54790000-2021_2022}) e (\ref{fig:jequitinhonhaSerieCompleta_t_vz_54790000-2021_2022}) apresentam gráficos comparativos entre a série original, sem dados imputados (incompleta), e a série após a imputação de dados (completa). Essa comparação, contrapondo a série fornecida pela ANA e os resultados após a inserção de dados, permitirá uma visualização mais clara do impacto das técnicas de preenchimento. Cabe relembrar que, inicialmente, foi aplicada a média dos últimos três anos para replicar a sazonalidade. Para os dados que permaneceram ausentes, utilizou-se o modelo kNN para completar a série. Esta estação, identificada como t\_vz\_54790000, apresentou 532 dias de dados nulos, o que corresponde a aproximadamente 13,24\% do total. Essa é a estação-alvo para a previsão das vazões.

\begin{figure}[!h]
	\centering
	\includegraphics[scale=0.25]{Figuras/jequiti/jequitinhonhaSerieIncompleta_t_vz_54790000.png}
	\caption{Série temporal incompleta da estação t\_vz\_54790000 \\(fonte: o autor)}
	\label{fig:jequitinhonhaSerieIncompleta_t_vz_54790000}
\end{figure}

A seguir, destaca-se o trecho da série com a maior quantidade de dados faltantes (figura \ref{fig:jequitinhonhaSerieIncompleta_t_vz_54790000-2013_2016}), que abrange o período de janeiro de 2013 a janeiro de 2016. Em sequência, é apresentada a série após a imputação dos dados (figura \ref{fig:jequitinhonhaSerieCompleta_t_vz_54790000-2013_2016}). Notavelmente, essa seção não apresentou resultados ideais, uma vez que a imputação atribuiu vazões zero em vários dias, o que não é realista, pois isso indicaria a secagem completa do rio, o que é improvável. No entanto, esses valores zero não impactaram significativamente os resultados finais da análise, já que se referem a um período distante do foco principal deste estudo. Uma alternativa seria excluir todo o trecho anterior ao ano de 2016, mas optou-se por manter a uniformidade nos critérios de aproveitamento dos dados ao longo do trabalho, dado que outros rios também foram analisados, e buscava-se assegurar consistência nos resultados.

\begin{figure}[!h]
	\centering
	\includegraphics[scale=0.25]{Figuras/jequiti/jequitinhonhaSerieIncompleta_t_vz_54790000-2013_2016.png}
	\caption{Detalhe da série temporal da estação t\_vz\_54790000, ainda sem dados imputados, de 2013 a 2016 (fonte: o autor)}
	\label{fig:jequitinhonhaSerieIncompleta_t_vz_54790000-2013_2016}
\end{figure}

\begin{figure}[!h]
	\centering
	\includegraphics[scale=0.25]{Figuras/jequiti/jequitinhonhaSerieCompleta_t_vz_54790000-2013_2016.png}
	\caption{Detalhe da série temporal da estação t\_vz\_54790000, com dados imputados, de 2013 a 2016 (fonte: o autor)}
	\label{fig:jequitinhonhaSerieCompleta_t_vz_54790000-2013_2016}
\end{figure}

Observe também o trecho de dados faltantes mais próximo ao final dos anos analisados, em 2021 e 2022 (figura \ref{fig:jequitinhonhaSerieIncompleta_t_vz_54790000-2021_2022}). Esta porção da série ficou boa visto que havia informação prévia suficiente, a inserção de dados respeitou coerentemente a sazonalidade (figura \ref{fig:jequitinhonhaSerieCompleta_t_vz_54790000-2021_2022}).

\begin{figure}[!h]
	\centering
	\includegraphics[scale=0.25]{Figuras/jequiti/jequitinhonhaSerieIncompleta_t_vz_54790000-2021_2022.png}
	\caption{Série temporal incompleta da estação t\_vz\_54790000 no detalhe entre 2021 e 2022 (fonte: o autor)}
	\label{fig:jequitinhonhaSerieIncompleta_t_vz_54790000-2021_2022}
\end{figure}

\begin{figure}[!h]
	\centering
	\includegraphics[scale=0.25]{Figuras/jequiti/jequitinhonhaSerieCompleta_t_vz_54790000-2021_2022.png}
	\caption{Série temporal completa da estação t\_vz\_54790000 no detalhe entre 2021 e 2022 (fonte: o autor)}
	\label{fig:jequitinhonhaSerieCompleta_t_vz_54790000-2021_2022}
\end{figure}

Por fim, uma visão ampla de como ficou a série temporal após os procedimentos de imputar os dados. (figura \ref{fig:jequitinhonhaSerieCompleta_t_vz_54790000})

\begin{figure}[!h]
	\centering
	\includegraphics[scale=0.25]{Figuras/jequiti/jequitinhonhaSerieCompleta_t_vz_54790000.png}
	\caption{Série temporal completa da estação t\_vz\_54790000\\(fonte: o autor)}
	\label{fig:jequitinhonhaSerieCompleta_t_vz_54790000}
\end{figure}

A mesma análise foi realizada para as estações de chuva. Na estação t\_cv\_54790000 (figura \ref{fig:jequitinhonhaSerieIncompleta_t_cv_54790000}) faltavam 273 dias de dados (6,79\%). Já a estação t\_cv\_01640000 estava totalmente preenchida, sem valores nulos. (figura \ref{fig:jequitinhonhaSerieCompleta_t_cv_01640000})

\begin{figure}[!h]
	\centering
	\includegraphics[scale=0.25]{Figuras/jequiti/jequitinhonhaSerieIncompleta_t_cv_54790000.png}
	\caption{Série temporal incompleta da estação t\_cv\_54790000\\(fonte: o autor)}
	\label{fig:jequitinhonhaSerieIncompleta_t_cv_54790000}
\end{figure}

Note que no início desta série de precipitação, o ano de 2013, não possuem dados. As séries de chuva completas ficaram desta forma (figuras \ref{fig:jequitinhonhaSerieCompleta_t_cv_54790000} e \ref{fig:jequitinhonhaSerieCompleta_t_cv_01640000})

\begin{figure}[!h]
	\centering
	\includegraphics[scale=0.25]{Figuras/jequiti/jequitinhonhaSerieCompleta_t_cv_54790000.png}
	\caption{Série temporal completa da estação t\_cv\_54790000\\(fonte: o autor)}
	\label{fig:jequitinhonhaSerieCompleta_t_cv_54790000}
\end{figure}

\begin{figure}[!h]
	\centering
	\includegraphics[scale=0.25]{Figuras/jequiti/jequitinhonhaSerieCompleta_t_cv_01640000.png}
	\caption{Série temporal completa da estação t\_cv\_01640000\\(fonte: o autor)}
	\label{fig:jequitinhonhaSerieCompleta_t_cv_01640000}
\end{figure}

\subsection{Rio Doce}

A estação alvo para o rio Doce é a estação c\_vz\_56994500. Sua série temporal foi a que apresentou melhor qualidade no que diz respeito à frequência de medições realizadas. Faltavam apenas 3 dias dos 4017 dias do período inteiro. Apenas o preenchimento sazonal bastou para completar a série e não foi preciso mais que isso. Cabe destacar a sazonalidade da série. Ficou bastante evidente este comportamento. (figura \ref{fig:doceSerieCompleta_c_vz_56994500})

\begin{figure}[!h]
	\centering
	\includegraphics[scale=0.25]{Figuras/rio_doce/doceSerieCompleta_c_vz_56994500.png}
	\caption{Série temporal completa da estação c\_vz\_56994500\\(fonte: o autor)}
	\label{fig:doceSerieCompleta_c_vz_56994500}
\end{figure}

Se para os dados de vazão no rio Doce a série foi, digamos, mais comportada, o mesmo não se pode dizer exatamente das estações de chuva. Ao menos, não para duas delas. Estas estações tiveram os dados desconsiderados e foram removidos das análises. Primeiro foi a estação t\_cv\_56990850 que possuía valores discrepantes demais para serem considerados. Valores da ordem de 7000 mm/dia, 8500 mm/dia. Além deste problema, havia ainda 3134 dias com dados nulos, o que representava 78\% do total. (figura \ref{fig:doceSerieIncompleta_t_cv_56990850})

A outra estação removida foi a t\_cv\_56994500. Conforme pode ser observado na figura \ref{fig:doceSerieCompleta_t_cv_56994500}, nela havia um longo hiato de dados zerados, voltando à normalidade apenas mais recentemente. Como as informações de precipitação que deveria haver para a estação no período do hiato podem ser retiradas de outras estações usadas na modelagem, optou-se por remover esta estação completamente do trabalho.

\begin{figure}[!h]
	\centering
	\includegraphics[scale=0.25]{Figuras/rio_doce/doceSerieIncompleta_t_cv_56990850.png}
	\caption{Série temporal da estação t\_cv\_56990850 - não utilizada\\(fonte: o autor)}
	\label{fig:doceSerieIncompleta_t_cv_56990850}
\end{figure}

\begin{figure}[!h]
	\centering
	\includegraphics[scale=0.25]{Figuras/rio_doce/doceSerieCompleta_t_cv_56994500.png}
	\caption{Série temporal da estação t\_cv\_56994500 - não utilizada\\(fonte: o autor)}
	\label{fig:doceSerieCompleta_t_cv_56994500}
\end{figure}

As estações que, enfim, foram empregadas na modelagem são as que estão na tabela e, adiante, o gráfico da série temporal de cada uma delas. (figuras \ref{fig:doceSerieCompleta_c_cv_01941010}, \ref{fig:doceSerieCompleta_c_cv_01941004}, \ref{fig:doceSerieCompleta_c_cv_01941006} e \ref{fig:doceSerieCompleta_t_cv_56990005})

\begin{table}[h!]
	\centering \small
	\caption{Estações de precipitação usadas - final \\(fonte: o autor)}
	\begin{tabular}{|c|c|c|} \hline
		\textbf{Estação} & \textbf{\# dados faltantes} & \textbf{\% dados faltantes} \\ \hline
		c\_cv\_01941010  & 153                         & 3,81 \\ \hline
		c\_cv\_01941004  & 31                          & 0,77 \\ \hline
		c\_cv\_01941006  & 0                           & 0,00 \\ \hline
		t\_cv\_56990005  & 1395                        & 34,73 \\ \hline
	\end{tabular}
	\label{tab:estacoes_chuva_usadas_final_rio_doce}
\end{table}

\begin{figure}[!h]
	\centering
	\includegraphics[scale=0.25]{Figuras/rio_doce/doceSerieCompleta_c_cv_01941010.png}
	\caption{Série temporal completa da estação c\_cv\_01941010\\(fonte: o autor)}
	\label{fig:doceSerieCompleta_c_cv_01941010}
\end{figure}

\begin{figure}[!h]
	\centering
	\includegraphics[scale=0.25]{Figuras/rio_doce/doceSerieCompleta_c_cv_01941004.png}
	\caption{Série temporal completa da estação c\_cv\_01941004\\(fonte: o autor)}
	\label{fig:doceSerieCompleta_c_cv_01941004}
\end{figure}

\begin{figure}[!h]
	\centering
	\includegraphics[scale=0.25]{Figuras/rio_doce/doceSerieCompleta_c_cv_01941006.png}
	\caption{Série temporal completa da estação c\_cv\_01941006\\(fonte: o autor)}
	\label{fig:doceSerieCompleta_c_cv_01941006}
\end{figure}

\begin{figure}[!h]
	\centering
	\includegraphics[scale=0.25]{Figuras/rio_doce/doceSerieCompleta_t_cv_56990005.png}
	\caption{Série temporal completa da estação t\_cv\_56990005\\(fonte: o autor)}
	\label{fig:doceSerieCompleta_t_cv_56990005}
\end{figure}

\clearpage
\subsection{Rio Grande}

O rio Grande apresentou desafios significativos ao longo de todo o desenvolvimento deste trabalho. A dificuldade inicial surgiu na ausência de dados disponíveis em estações dentro do estado de Minas Gerais para o período de análise estipulado, conforme mencionado anteriormente. Foi necessário buscar uma estação o mais próxima possível da divisa com Minas Gerais, localizada no estado de São Paulo, especificamente no município de Ilha Solteira. Entretanto, os desafios não se limitaram a essa questão geográfica.

A série temporal de vazão da estação selecionada, denominada t\_vz\_62020080, estava incompleta e não abrangia todo o período de 11 anos estipulado para a análise. (figura \ref{fig:grandeSerieIncompleta_t_vz_62020080}) Os dados disponíveis mais antigos datavam de 2020. Contudo, em conformidade com o escopo estabelecido para este estudo, foi realizado o preenchimento dos dados faltantes, aplicando-se o mesmo protocolo utilizado para os demais rios analisados. Este procedimento foi necessário para garantir a consistência, integridade e comparabilidade das análises subsequentes.

\begin{figure}[!h]
	\centering
	\includegraphics[scale=0.25]{Figuras/rio_grande/grandeSerieIncompleta_t_vz_62020080.png}
	\caption{Série temporal incompleta da estação t\_vz\_62020080\\(fonte: o autor)}
	\label{fig:grandeSerieIncompleta_t_vz_62020080}
\end{figure}

Infelizmente, o caráter ruidoso da série permaneceu mesmo após a aplicação do protocolo de preenchimento dos dados ausentes, conforme pode ser observado na imagem final gerada.(figura \ref{fig:grandeSerieCompleta_t_vz_62020080}) A série em questão apresentava 2099 dias faltantes, correspondendo a aproximadamente 64\% de dados nulos. Outro aspecto relevante para essa estação é que, diferentemente das outras, não foram utilizados os 4.017 registros previstos inicialmente. As informações mais antigas disponíveis datavam de 2015, resultando, assim, em um total de 3289 registros diários utilizados especificamente para o rio Grande.

\begin{figure}[!h]
	\centering
	\includegraphics[scale=0.25]{Figuras/rio_grande/grandeSerieCompleta_t_vz_62020080.png}
	\caption{Série temporal completa da estação t\_vz\_62020080\\(fonte: o autor)}
	\label{fig:grandeSerieCompleta_t_vz_62020080}
\end{figure}

A estação de precipitação utilizada, a única neste caso, foi a estação t\_cv\_61998080, pois foi a única que apresentou dados válidos. Curiosamente, outra estação de precipitação disponível também apresentou dados para o período analisado, mas a base de dados consistia exclusivamente em valores zero. Por essa razão, a estação t\_cv\_62020080 foi completamente excluída do estudo.

Em relação à estação t\_cv\_61998080, houve necessidade de preencher apenas um número reduzido de dados ausentes, totalizando 169 registros, o que correspondia a 5,14\% do total. (figura \ref{fig:grandeSerieCompleta_t_cv_61998080}) Trata-se de uma série com uma quantidade expressiva de dados, que efetivamente pôde contribuir de maneira significativa para as análises realizadas.

\begin{figure}[!h]
	\centering
	\includegraphics[scale=0.25]{Figuras/rio_grande/grandeSerieCompleta_t_cv_61998080.png}
	\caption{Série completa da estação t\_cv\_61998080\\(fonte: o autor)}
	\label{fig:grandeSerieCompleta_t_cv_61998080}
\end{figure}

Ressalta-se que o trecho de dados faltantes para a estação t\_cv\_61998080 concentrava-se no início da série temporal, especificamente no ano de 2015. No gráfico os dados já estão imputados.

\clearpage
\subsection{Rio São Francisco}

Por fim, foi realizado o procedimento de preenchimento dos dados nulos para o rio São Francisco. A estação-alvo c\_vz\_44290002 apresentou uma série bastante completa ao longo do período de análise, com apenas 120 dias nulos em um total de 4017 dias. O trecho com dados faltantes pode ser observado em detalhe na figura (\ref{fig:franciscoSerieIncompleta_c_vz_44290002-detalhe}).

Para esta estação, o preenchimento sazonal foi suficiente para suprir as lacunas existentes, não sendo necessário aplicar procedimentos adicionais de imputação de dados. (figura \ref{fig:franciscoSerieCompleta_c_vz_44290002})

\begin{figure}[!h]
	\centering
	\includegraphics[scale=0.25]{Figuras/rio_sao_francisco/franciscoSerieIncompleta_c_vz_44290002-detalhe.png}
	\caption{Detalhe do trecho com dados nulos da estação c\_vz\_44290002\\(fonte: o autor)}
	\label{fig:franciscoSerieIncompleta_c_vz_44290002-detalhe}
\end{figure}

\begin{figure}[!h]
	\centering
	\includegraphics[scale=0.25]{Figuras/rio_sao_francisco/franciscoSerieCompleta_c_vz_44290002.png}
	\caption{Série temporal completa da estação c\_vz\_44290002\\(fonte: o autor)}
	\label{fig:franciscoSerieCompleta_c_vz_44290002}
\end{figure}
\clearpage

No que se refere às estações de precipitação selecionadas para a análise no rio São Francisco, não foi necessário realizar nenhuma inserção de dados, uma vez que todas as séries estavam completas, abrangendo a totalidade dos 4017 dias de registro. As séries temporais correspondentes podem ser visualizadas nos gráficos apresentados a seguir. (figuras \ref{fig:franciscoSerieCompleta_c_cv_01544017}, \ref{fig:franciscoSerieCompleta_c_cv_01544032}, \ref{fig:franciscoSerieCompleta_c_cv_01544036})

\begin{figure}[!h]
	\centering
	\includegraphics[scale=0.25]{Figuras/rio_sao_francisco/franciscoSerieCompleta_c_cv_01544017.png}
	\caption{Série temporal completa da estação c\_cv\_01544017\\(fonte: o autor)}
	\label{fig:franciscoSerieCompleta_c_cv_01544017}
\end{figure}

\begin{figure}[!h]
	\centering
	\includegraphics[scale=0.25]{Figuras/rio_sao_francisco/franciscoSerieCompleta_c_cv_01544032.png}
	\caption{Série temporal completa da estação c\_cv\_01544032\\(fonte: o autor)}
	\label{fig:franciscoSerieCompleta_c_cv_01544032}
\end{figure}

\begin{figure}[!h]
	\centering
	\includegraphics[scale=0.25]{Figuras/rio_sao_francisco/franciscoSerieCompleta_c_cv_01544036.png}
	\caption{Série temporal completa da estação c\_cv\_01544036\\(fonte: o autor)}
	\label{fig:franciscoSerieCompleta_c_cv_01544036}
\end{figure}
\clearpage

\section{Variáveis Utilizadas}
%Listar e explicar as variáveis contínuas e categóricas utilizadas nos modelos.

As variáveis do trabalho, exceto as categóricas, obviamente, são todas contínuas. Todas as séries temporais foram ajustadas para estarem completas dentro do período trabalhado, totalizando 4017 registros diários. A exceção ficou por conta dos dados do rio Grande, em que o dado mais antigo foi o dia 30 de dezembro de 2014.

De início, os valores passados (\textit{lags}) de vazão da estação alvo foram utilizados como variáveis preditoras. Utilizou-se 7 dias passados, ou seja, o valor de uma semana passada para capturar o comportamento mais imediatamente próximo da vazão medida na estação.

Para que se tenha uma noção melhor, abaixo seguem alguns dados estatísticos relevantes que informam sobre os dados de vazão e precipitação utilizados. Conste-se que as unidades de precipitação estão em mm/dia e vazão em $m^3/s$.

\begin{table}[!h]
	\centering \small
	\caption{Variáveis utilizadas - rio Jequitinhonha \\(fonte: o autor)}
	\begin{tabular}{|l|r|r|r|r|r|r|} \hline 
		\textbf{Variável}   & \textbf{\#} & \textbf{Média} & \textbf{Desvio-padrão} & \textbf{Mín} & \textbf{< 50\%} & \textbf{Máx} \\\hline
		t\_cv\_01640000     & 4017        & 1,58           & 6,85                   & 0,00         & 0,00            & 166,60       \\\hline
		t\_cv\_54790000     & 4017        & 1,68           & 6,31                   & 0,00         & 0,00            & 102,60       \\\hline
		t\_vz\_54790000 (y) & 4017        & 160,95         & 267,90                 & 0,00         & 95,95           & 3716,65      \\\hline
	\end{tabular}
	\label{tab:variaveis_jequitinhonha}
\end{table}

\begin{table}[!h]
	\centering \small
	\caption{Variáveis utilizadas - rio Doce \\(fonte: o autor)}
	\begin{tabular}{|l|r|r|r|r|r|r|} \hline 
		\textbf{Variável}   & \textbf{\#} & \textbf{Média} & \textbf{Desvio-padrão} & \textbf{Mín} & \textbf{< 50\%} & \textbf{Máx} \\\hline
		c\_cv\_01941010     & 4017        & 2,21           & 8,41                   & 0,00         & 0,00            & 125,60       \\\hline
		c\_cv\_01941004     & 4017        & 2,59           & 9,83                   & 0,00         & 0,00            & 131,00       \\\hline
		c\_cv\_01941006     & 4017        & 2,44           & 9,76                   & 0,00         & 0,00            & 156,60       \\\hline
		t\_cv\_56990005     & 4017        & 1,15           & 5,19                   & 0,00         & 0,00            & 124,80       \\\hline
		c\_vz\_56994500 (y) & 4017        & 542,05         & 656,99                 & 75,15        & 341,26          & 11655,20     \\\hline
	\end{tabular}
	\label{tab:variaveis_rio_doce}
\end{table}

\begin{table}[!h]
	\centering \small
	\caption{Variáveis utilizadas - rio Grande \\(fonte: o autor)}
	\begin{tabular}{|l|r|r|r|r|r|r|} \hline 
		\textbf{Variável}   & \textbf{\#} & \textbf{Média} & \textbf{Desvio-padrão} & \textbf{Mín} & \textbf{< 50\%} & \textbf{Máx} \\\hline
		t\_cv\_61998080     & 3289        & 3,13           & 13,92                  & 0,00         & 0,00            & 330,40       \\\hline
		t\_vz\_62020080 (y) & 3289        & 3405,27        & 873,88                 & 1603,58      & 3170,08         & 11939,49     \\\hline
	\end{tabular}
	\label{tab:variaveis_rio_grande}
\end{table}

\begin{table}[!h]
	\centering \small
	\caption{Variáveis utilizadas - rio São Francisco \\(fonte: o autor)}
	\begin{tabular}{|l|r|r|r|r|r|r|} \hline 
		\textbf{Variável}   & \textbf{\#} & \textbf{Média} & \textbf{Desvio-padrão} & \textbf{Mín} & \textbf{< 50\%} & \textbf{Máx} \\\hline
		c\_cv\_01544017     & 4017        & 1,60           & 7,39                   & 0,00         & 0,00            & 110,00       \\\hline
		c\_cv\_01544032     & 4017        & 2,30           & 8,13                   & 0,00         & 0,00            & 125,40       \\\hline
		c\_cv\_01544036     & 4017        & 1,99           & 7,59                   & 0,00         & 0,00            & 112,00       \\\hline
		c\_vz\_44290002 (y) & 4017        & 1115,88        & 998,40                 & 254,75       & 812,26          & 7338,65      \\\hline
	\end{tabular}
	\label{tab:variaveis_rio_sao_francisco}
\end{table}
\clearpage

É possível identificar algumas questões importantes sobre a massa de dados a partir destas tabelas. Observe que para o rio Jequitinhonha (tabela \ref{tab:variaveis_jequitinhonha}) a vazão mínima foi 0,00 $m^3/s$, o que denotaria que o rio passou por um período de seca. Porém não foi encontrado, seja em artigos científicos sobre o rio, quanto em matérias de jornais, que o rio Jequitinhonha tenha passado por isso no período analisado. Não é de se surpreender, contudo, que estes valores zero tenham sido inseridos quando da imputação dos dados, visto que este trecho da série temporal era onde estava a maior lacuna. No entanto, não foi feita substituição dos valores zero por, digamos, a média de vazão. Estas e outras incertezas que permearam todas análises foram, onde puder e couber, discutidas, mas manteve-se o trabalho mesmo com estas questões levantadas, sem fazer um tratamento específico. Uma observação geral sobre os dados de vazão é que existe uma amplitude elevada entre o mínimo e o máximo, em todas as estações utilizadas, com uma pequena variação para o rio Grande. Contudo, com este rio especificamente, os dados de vazão tiveram alguns problemas e dificuldades e é provável que estes números não estejam coerentes com a realidade. Mas o rio Doce é realmente considerável. (tabela \ref{tab:variaveis_rio_doce}) Vale destacar, no entanto, que esta amplitude não especifica se foi dentro de um ano. É ao longo de toda série temporal, ou seja, ao longo dos 11 anos de dados considerados.

As variáveis de precipitação, mesmo considerando o somatório diário de precipitação, tiveram muitos dados zero. Nota-se isso a partir da análise da coluna ``< 50\%'', que significa metade de toda massa de dados de precipitação estavam abaixo deste valor, ou seja, metade de todos os dados de precipitação estavam em 0,00 mm/dia. Isso reflete a dificuldade em se obter dados de precipitação. Essa enorme quantidade de valores zerados poderiam prejudicar as análises. Foi então que algumas variáveis adicionais foram inseridas para todos os rios deste trablho em vias de aflorar a importância das precipitações nas análises, tentar dar um peso significativo à elas no treinamento dos modelos. As novas variáveis foram:

\begin{table}[!h]
	\centering \small
	\caption{Variáveis acumuladas para as precipitações \\(fonte: o autor)}
	\begin{tabular}{|l|l|} \hline 
		\textbf{Nome da variável}    & \textbf{Descrição}                          \\\hline
		<ESTAÇÃO>\_soma\_3\_dias     & Soma das precipitações dos últimos 3 dias   \\\hline
		<ESTAÇÃO>\_soma\_7\_dias     & Soma das precipitações dos últimos 7 dias   \\\hline
		<ESTAÇÃO>\_media\_30\_dias   & Média das precipitações dos últimos 30 dias \\\hline
	\end{tabular}
	\label{tab:variaveis_acumuladas}
\end{table}

Quanto aos dados categóricos utilizados neste estudo, inicialmente foi pensado utilizar as informações de dia do ano (`\textit{dayofyear}'), semana do ano (`\textit{week}'), mês (`\textit{month}') e estação do ano. Com exceção da variável de estação do ano (`estacao'), para a qual foi desenvolvido um algoritmo específico, as demais informações foram extraídas utilizando a biblioteca Pandas.\cite{mckinney2011pandas} Porém, as variáveis `\textit{week}' e `\textit{dayofyear}' possuem uma elevada cardinalidade, que vão de 1 a 53 e de 1 a 365 (366 em ano bissexto), respectivamente. Isso poderia representar um problema para o modelo de regressão linear, causar um enviesamento do modelo devido a estes valores ficarem numa escala superior às demais variáveis, fosse com os dados log-transformados, fosse com os dados normalizados de 0 a 1 (MinMax). E estas variáveis não devem ser transformadas pois isso tiraria o caráter categórico delas. Como prática comum, aplica-se transformações apenas nas variáveis contínuas.

Pois bem, havia uma dificuldade aqui, uma vez que essas variáveis categóricas seriam incorporadas com o objetivo de capturar o comportamento sazonal da série temporal. Numa análise mais aprofundada, optou-se por retirar ambas as variáveis `\textit{week}' e `\textit{dayofyear}' pois as informações que elas guardam poderiam estar contidas nas variáveis de `estacao' e `\textit{month}'. Há uma correlação elevada entre o dia do ano, a semana do ano e o mês do ano e como o problema era a cardinalidade daquelas variáveis, mês do ano passou, desta forma, a representar também a informação de que se precisava.

Observa-se que os regimes de precipitação e vazão tendem a se repetir nas estações de primavera e verão, com uma redução significativa durante o outono e inverno. Por isso `estacao' foi utilizada. Todas variáveis foram codificadas no esquema ``\textit{label encoding}'' e desta forma as faixas de valores foram 1 a 12 para `\textit{month}' e de 1 a 4 para `estacao'.

\section{Análise exploratória dos dados}

Com os dados ajustados, algumas variáveis removidas e as séries temporais contínuas, deu-se início à análise exploratória dos dados. Esta etapa é fundamental para compreender o comportamento das séries temporais.

As análises realizadas foram idênticas para todos os rios estudados, de modo que a descrição desta fase será apresentada de forma geral, sem a necessidade de subdivisão por rio.

O primeiro passo foi verificar a sazonalidade dos dados. Foram avaliadas apenas as variáveis endógenas, ou seja, as vazões. Um teste de autocorrelação foi suficiente para identificar a presença de sazonalidade. Além disso, realizou-se a decomposição das séries temporais em suas componentes sazonais para uma análise mais detalhada. A função de autocorrelação (ACF) é uma ferramenta essencial para identificar como os valores passados influenciam os valores futuros em uma série temporal, permitindo a detecção de padrões sazonais, ciclos e tendências.

A decomposição das séries temporais foi realizada utilizando a biblioteca StatsModels, aplicando o modelo aditivo.\cite{seabold2010statsmodels} A série temporal do rio Grande apresentou o pior desempenho em termos de autocorrelação.(figura \ref{fig:acf_rio_grande}) A decomposição da série também revelou um comportamento mais ruidoso, o que pode ser atribuído ao fato de esta série conter mais lacunas e apresentar maiores desafios no preenchimento dos dados ausentes.(figura \ref{fig:sazonalidade_rio_grande}) Nos gráficos de autocorrelação, o \textit{lag} de 365 dias – correspondente a um ano – foi destacado com uma linha preta vertical.

\begin{figure}[!h]
	\centering
	\includegraphics[scale=0.33]{Figuras/jequiti/acf_jequitinhonha.png}
	\caption{Autocorrelação para a vazão do rio Jequitinhonha\\(fonte: o autor)}
	\label{fig:acf_jequitinhonha}
\end{figure}

\begin{figure}[!h]
	\centering
	\includegraphics[scale=0.33]{Figuras/jequiti/sazonalidade_jequitinhonha.png}
	\caption{Componente sazonal da série de vazão do rio Jequitinhonha\\(fonte: o autor)}
	\label{fig:sazonalidade_jequitinhonha}
\end{figure}

\begin{figure}[!h]
	\centering
	\includegraphics[scale=0.33]{Figuras/rio_doce/acf_rio_doce.png}
	\caption{Autocorrelação para a vazão do rio Doce\\(fonte: o autor)}
	\label{fig:acf_rio_doce}
\end{figure}

\begin{figure}[!h]
	\centering
	\includegraphics[scale=0.33]{Figuras/rio_doce/sazonalidade_rio_doce.png}
	\caption{Componente sazonal da série de vazão do rio Doce\\(fonte: o autor)}
	\label{fig:sazonalidade_rio_doce}
\end{figure}

\begin{figure}[!h]
	\centering
	\includegraphics[scale=0.33]{Figuras/rio_grande/acf_rio_grande.png}
	\caption{Autocorrelação para a vazão do rio Grande\\(fonte: o autor)}
	\label{fig:acf_rio_grande}
\end{figure}

\begin{figure}[!h]
	\centering
	\includegraphics[scale=0.33]{Figuras/rio_grande/sazonalidade_rio_grande.png}
	\caption{Componente sazonal da série de vazão do rio Grande\\(fonte: o autor)}
	\label{fig:sazonalidade_rio_grande}
\end{figure}

\begin{figure}[!h]
	\centering
	\includegraphics[scale=0.33]{Figuras/rio_sao_francisco/acf_rio_sao_francisco.png}
	\caption{Autocorrelação para a vazão do rio São Francisco\\(fonte: o autor)}
	\label{fig:acf_rio_sao_francisco}
\end{figure}

\begin{figure}[!h]
	\centering
	\includegraphics[scale=0.33]{Figuras/rio_sao_francisco/sazonalidade_rio_sao_francisco.png}
	\caption{Componente sazonal da série de vazão do rio São Francisco\\(fonte: o autor)}
	\label{fig:sazonalidade_rio_sao_francisco}
\end{figure}

As séries temporais consideradas, digamos, mais bem comportadas foram as dos rios Doce e São Francisco.(figuras (\ref{fig:acf_rio_doce}), (\ref{fig:acf_rio_sao_francisco})) A decomposição sazonal da série do rio Jequitinhonha apresentou algum nível de ruído, embora a sazonalidade tenha sido caracterizada de forma clara.

%Além da sazonalidade, a análise exploratória também incluiu a verificação da estacionariedade das séries temporais. Embora modelos estatísticos como o ARIMA não tenham sido aplicados neste trabalho, a identificação da estacionariedade é um aspecto relevante para qualquer modelo que venha a ser utilizado. Uma série estacionária possui propriedades estatísticas, como média, variância e autocorrelação, que permanecem constantes ao longo do tempo. Isso pode favorecer a convergência dos modelos preditivos e melhorar sua capacidade de previsão.
%
%Para este estudo foi aplicado um teste ADF (\textit{Augmented Dickey-Fuller} - Dickey-Fuller Aumentado) em que um valor-p (\textit{p-value}) menor ou igual a 0,05 (<= 0,05) confirmaria a estacionariedade. A biblioteca sktime tem um método pra isso e foi utilizado.\cite{loning2019sktime}

Outra característica investigada neste estudo foi a presença de `cauda longa' nos dados de precipitação e vazão. Esse comportamento é comumente observado em dados ambientais dessa natureza.\cite{elena_macdonald_2023}

A `cauda longa' refere-se a uma distribuição de frequência na qual uma proporção significativa dos eventos ocorre em uma região distante do centro ou da média da distribuição. Em uma distribuição normal, a maioria dos eventos se concentra em torno da média, com poucas ocorrências nas extremidades (caudas). No entanto, na distribuição com cauda longa, essas extremidades contêm uma quantidade substancial de eventos, que, somados, podem representar uma fração importante do total. A análise de cauda longa é um campo específico da estatística, desenvolvido para lidar com eventos de baixa frequência, mas de alta magnitude. No entanto, este trabalho não se aprofundou nas técnicas avançadas de análise de cauda longa; o foco aqui foi identificar a presença desse fenômeno e determinar um tratamento adequado para os dados.

A mitigação do efeito de cauda longa é particularmente relevante para modelos como a Regressão Linear, que pressupõe uma distribuição normal dos dados. Uma distribuição assimétrica pode comprometer a convergência do modelo. Os dados transformados foram utilizados para todos os modelos, indistintamente, visando garantir uma padronização do estudo.

%Embora os modelos baseados em \textit{boosting} utilizados neste estudo, como o CatBoost e o LightGBM, não sejam tão sensíveis a esse efeito, pois captam relações não-lineares e complexas de forma eficiente, optou-se por aplicar o mesmo tratamento a todos os modelos para garantir uma padronização na apresentação dos dados.

Posto que os dados contêm valores iguais a zero, a transformação pelo logaritmo natural (ln(.)) não foi aplicada, pois o cálculo de logaritmo não é definido para valores zero. Ao invés disso, foi utilizada a transformação `log1p(.)' da biblioteca NumPy \cite{numpyref}, que adiciona 1 ao valor antes da transformação, evitando erros relacionados ao logaritmo de zero.

Existem outras formas de ajustar a distribuição dos dados, tais como Box-Cox, Yeo-Johnson e transformação por quantis [REF REF], mas era necessário que houvesse fácil reversibilidade nos valores finais preditos e que garantisse interpretabilidade, por isso optou-se por uma transformação simples mas que atendeu satisfatoriamente ao próposito.

Após a transformação a distribuição dos eventos ficou menos assimétrica, como pode ser visto nas figuras \ref{fig:jequitinhonha_antes_log}, \ref{fig:jequitinhonha_depois_log}, \ref{fig:rio_doce_antes_log}, \ref{fig:rio_doce_depois_log}, \ref{fig:rio_grande_antes_log}, \ref{fig:rio_grande_depois_log}, \ref{fig:rio_sao_francisco_antes_log}, \ref{fig:rio_sao_francisco_depois_log}. Para o rio Grande, visualmente, parece não ter havido tanta diferença, mas quando se analisa os valores originais e transformados, houve um achatamento na distância entre os valores máximo e o mínimo da série.

\begin{figure}[!h]
	\centering
	\includegraphics[scale=0.33]{Figuras/jequiti/jequitinhonha_antes_log.png}
	\caption{Dados originais para o rio Jequitinhonha\\(fonte: o autor)}
	\label{fig:jequitinhonha_antes_log}
\end{figure}

\begin{figure}[!h]
	\centering
	\includegraphics[scale=0.33]{Figuras/jequiti/jequitinhonha_depois_log.png}
	\caption{Dados log-transformados para o rio Jequitinhonha\\(fonte: o autor)}
	\label{fig:jequitinhonha_depois_log}
\end{figure}

\begin{figure}[!h]
	\centering
	\includegraphics[scale=0.33]{Figuras/rio_doce/rio_doce_antes_log.png}
	\caption{Dados originais para o rio Doce\\(fonte: o autor)}
	\label{fig:rio_doce_antes_log}
\end{figure}

\begin{figure}[!h]
	\centering
	\includegraphics[scale=0.33]{Figuras/rio_doce/rio_doce_depois_log.png}
	\caption{Dados log-transformados para o rio Doce\\(fonte: o autor)}
	\label{fig:rio_doce_depois_log}
\end{figure}

\begin{figure}[!h]
	\centering
	\includegraphics[scale=0.33]{Figuras/rio_grande/rio_grande_antes_log.png}
	\caption{Dados originais para o rio Grande\\(fonte: o autor)}
	\label{fig:rio_grande_antes_log}
\end{figure}

\begin{figure}[!h]
	\centering
	\includegraphics[scale=0.33]{Figuras/rio_grande/rio_grande_depois_log.png}
	\caption{Dados log-transformados para o rio Grande\\(fonte: o autor)}
	\label{fig:rio_grande_depois_log}
\end{figure}

\begin{figure}[!h]
	\centering
	\includegraphics[scale=0.33]{Figuras/rio_sao_francisco/rio_sao_francisco_antes_log.png}
	\caption{Dados originais para o rio São Francisco\\(fonte: o autor)}
	\label{fig:rio_sao_francisco_antes_log}
\end{figure}

\begin{figure}[!h]
	\centering
	\includegraphics[scale=0.33]{Figuras/rio_sao_francisco/rio_sao_francisco_depois_log.png}
	\caption{Dados log-transformados para o rio São Francisco\\(fonte: o autor)}
	\label{fig:rio_sao_francisco_depois_log}
\end{figure}
\clearpage

Para finalizar, uma análise comumente realizada em séries temporais é a verificação de sua estacionariedade. A estacionariedade pressupõe que características estatísticas da série, como média e variância, permaneçam constantes ao longo do tempo. No entanto, neste estudo, essa avaliação não foi realizada, pois séries temporais de dados ambientais, como precipitação e vazão, geralmente apresentam sazonalidade e tendências que violam o conceito de estacionariedade, conforme explicado em \citet{hyndman_fpp3_2024e}. Outros desafios a esta análise também incluem a rápida mudança do uso do solo e remoção de cobertura vegetal original, alterando significativamente a dinâmica hidrológica da região.\cite{rayyan-33388453}

Essas características, longe de serem consideradas como ruído ou anomalias, fazem parte da própria natureza dos dados ambientais e são cruciais para a modelagem e previsão. Assim, em oposição a tentar forçar a estacionariedade, este trabalho optou por lidar com a sazonalidade e as tendências diretamente, utilizando técnicas que captam essas dinâmicas, visando garantir previsões mais realistas e representativas dos processos hidrológicos.

\section{Modelos de Aprendizado de Máquina}
%Apresentar os modelos de ML utilizados (SeasonalNaive, LinearRegression, CatBoost e LightGBM) e justificativas.

\subsection{Seasonal Naive - SN}

Um método que é similar ao \textit{Naive}, contudo, usa a última observação conhecida do mesmo período de tempo (por exemplo, mesmo dia do mês anterior, mesma semana do ano anterior) numa tentativa de capturar o comportamento sazonal.

O \textit{Seasonal Naive} não pode ser considerado um modelo de previsão sofisticado. Em vez disso, ele funciona como uma linha de base (\textit{baseline}), servindo como ponto de partida para avaliar o desempenho de outros modelos de previsão.\cite{hyndman_fpp3_2024d}

Por ser um modelo simples, ele não captura tendências ou variações complexas, mas estabelece um \textit{benchmark} mínimo com o qual outros métodos mais elaborados e complexos devem ser comparados.

Para este modelo ser executado foi preciso ajustar o hiperparâmetro de sazonalidade, que é de 365 dias.

\subsection{Regressão Linear - LR}

O modelo de Regressão Linear (\textit{Linear Regression} - LR) é uma abordagem estatística simples, porém poderosa, que busca modelar o relacionamento entre uma variável dependente e uma ou mais variáveis independentes através de uma linha reta.

\begin{equation}
	y_{t} = \beta_{0} + \beta_{1} x_{1,t} + \beta_{2} x_{2,t} + \cdots +
	\beta_{k} x_{k,t} + \varepsilon_{t}
\end{equation}

O funcionamento da Regressão Linear envolve o cálculo de coeficientes para as variáveis independentes, que determinam o peso de cada uma destas variáveis na previsão da variável dependente. O objetivo do modelo é minimizar o somatório do erro quadrático, ou seja, a soma dos quadrados das diferenças entre os valores previstos e os valores reais.\cite{hyndman_fpp3_2024c}

\begin{equation}
	\sum_{t=1}^n \varepsilon_t^2 = \sum_{t=1}^n (y_t -
	\beta_{0} - \beta_{1} x_{1,t} - \beta_{2} x_{2,t} - \cdots - \beta_{k} x_{k,t})^2.
\end{equation}
\begin{itemize}
	\item $y_t$ valores observados
	\item $\beta_{0} , \beta_{1} , \cdots , \beta_{k}$ coeficientes para as variáveis independentes
	\item $x_{1,t} , x_{2,t} , \cdots , x_{k,t}$ variáveis independentes
	\item $n$ número de observações
\end{itemize}

Os resultados obtidos com este modelo mostraram-se muito bons, e na verdade, ele se destacou como um modelo-base robusto para os outros modelos mais complexos. Sua simplicidade e eficácia tornam-no uma escolha bastante sólida. Não houve nenhuma seleção de hiperparâmetro para executar este modelo, foi utilizado conforme o padrão da biblioteca.

\subsection{CatBoost - CB}

CatBoost (\textit{Categorical Boosting}) tem o funcionamento baseado no princípio da construção de modelos fracos de árvores de decisão (\textit{decision tree}) de forma sequencial, onde cada árvore sucessiva é treinada para corrigir os erros da árvore anterior. A estratégia do CatBoost, no entanto, tem um nome: ``\textit{Ordered Boosting}''. A construção das árvores se dá de maneira sequencial, porém não se usa todos os dados disponíveis para isso. Os dados de treinamento são ordenados de maneira aleatória e apenas partições destes dados são utilizados no processo. Por trabalhar sempre com uma amostra dos dados de treinamento, e a apresentação aleatória destes dados ao modelo, o CatBoost tem resiliência ao \textit{overfitting}, mas parâmetros que realizam ajustes nas árvores de decisão também estão presentes e o pesquisador tem controle sobre eles.\cite{catboost_docs}\cite{dorogush2018catboost}\cite{prokhorenkova2018catboost}

Os hiperparâmetros para execução do modelo foram escolhidos para que o modelo executasse sem escrever (`\textit{allow\_writing\_files}') cada passo de treinamento em disco durante a execução, pra salvar espaço em disco e evitar \textit{overhead} dessa escrita desnecessária. As variáveis categóricas foram passadas através do hiperparâmetro `\textit{cat\_features}' e `\textit{thread\_count}' para executar em paralelo, pra acelerar o treinamento do modelo. O hiperparâmetro `verbose' é pra não escrever cada passo de treinamento na saída de texto do sistema e `\textit{random\_seed}' é pra garantir reprodutibilidade dos resultados em todas as execuções do modelo. Apenas estes hiperparâmetros foram selecionados, tudo mais ficou de acordo com o padrão da biblioteca.

\begin{table}[!h]
	\centering \small
	\caption{Hiperparâmetros para o modelo CatBoost\\(fonte: o autor)}
	\begin{tabular}{|l|l|} \hline 
		\textbf{Hiperparâmetro} & \textbf{Valor} \\\hline
		random\_seed            & 1984                 \\\hline
		cat\_features           & ['estacao', 'month'] \\\hline
		verbose                 & False                \\\hline
		allow\_writing\_files   & False                \\\hline
		thread\_count           & os.cpu\_count()//2   \\\hline
	\end{tabular}
	\label{tab:hiperparametros_catboost}
\end{table}

%\begin{figure}[!h]
%	\centering
%	\includegraphics[scale=0.75]{Figuras/boosting_diagrama.jpg}
%	\caption{Diagrama resumindo o funcionamento dos modelos de \textit{boosting} (fonte: o autor)}
%	\label{fig:boosting_diagrama}
%\end{figure}

\subsection{Floresta Aleatória - RF}

Floresta Aleatória (\textit{Random Forest}) é um modelo que também é baseado em árvores de decisão e é amplamente utilizado em tarefas de regressão e classificação. O modelo combina diversas árvores de decisão para aprimorar a precisão e a estabilidade dos resultados.

O modelo cria diversas árvores de decisão independentemente, e cada destas árvores é treinada com partições aleatórias dos dados de treinamento, garantindo que as árvores sejam distintas entre si. Na seleção dos dados pode haver reposição (\textit{bootstrapping}), ou seja, os mesmos dados podem ser utilizados para treinar árvores diferentes ou até mesmo dados podem nunca ser utilizados em nenhuma árvore. Isso é para garantir diversidade entre as árvores. Durante a criação de cada nó da árvore, um subcojunto aleatório dos dados de treinamento é utilizado e isso vai até não ser mais possível criar novas divisões (\textit{Depth-wise Growth}). Ao fim, quando cada árvore foi treinada, a agregação dos resultados se dá calculando a média entre todas elas (\textit{bagging}).\cite{hasan_ahmed_salman_2024}\cite{sklearn_random_forest_2024}

A escolha do modelo certo para um problema de previsão desta natureza depende das características dos dados e dos objetivos do estudo. O \textit{Seasonal Naive}, embora simples, é um importante ponto de referência inicial. O modelo de Regressão Linear serve como uma \textit{baseline} confiável devido à sua eficácia e simplicidade. Já os modelos CatBoost e Floresta Aleatória foram opções mais avançadas, capazes de lidar com a complexidade dos dados e oferecer previsões precisas e eficientes. A comparação entre todos estes modelos permitiu que se escolhesse a abordagem que melhor atendesse às necessidades específicas da previsão de vazões.

Seguindo a mesma intenção de antes, `\textit{random\_state}' está aqui para garantir reprodutbilidade dos resultados entre diversas execuções. Por fim, `\textit{verbose}' é para não ficar escrevendo na saída de texto do sistema e `\textit{n\_jobs}' para executar com paralelismo o treinamento do modelo. O modelo RandomForest não trata variáveis categóricas diretamente, por isso não tem nenhum hiperparâmetro a respeito disso.

\begin{table}[!h]
	\centering \small
	\caption{Hiperparâmetros para o modelo RandomForest\\(fonte: o autor)}
	\begin{tabular}{|l|l|} \hline 
		\textbf{Hiperparâmetro} & \textbf{Valor}     \\\hline
		random\_state           & 1984               \\\hline
		verbose                 & 0                  \\\hline
		n\_jobs                 & os.cpu\_count()//2 \\\hline
	\end{tabular}
	\label{tab:hiperparametros_randomforest}
\end{table}


\section{Métricas de Avaliação}
%Listar as métricas usadas para avaliar o desempenho dos modelos (MAPE, RMSE, PBias* e KGE não-paramétrico**).
%(*: PBias ajuda a ver se o modelo está subestimando as previsões ou superestimando)
%(**: KGEnp (não paramétrico) é uma métrica comum e muito consagrada na hidrologia. Ela tem resiliência a outliers ao avaliar a qualidade do modelo)

Para avaliar o desempenho dos modelos de previsão utilizados neste estudo, foram adotadas quatro métricas: MAPE (\textit{Mean Absolute Percentage Error}), RMSE (\textit{Root Mean Square Error}), PBIAS (\textit{Percent Bias}) e KGE (\textit{Kling-Gupta Efficiency}). A escolha dessas métricas baseia-se na necessidade de uma avaliação abrangente que considere diferentes aspectos da qualidade das previsões, como precisão, erro médio, tendência e correlação.

\begin{itemize}
	\item \textbf{MAPE (\textit{Mean Absolute Percentage Error})}: A MAPE é uma métrica amplamente utilizada para medir a precisão das previsões em termos percentuais. O algoritmo calcula a média das diferenças absolutas entre os valores observados e previstos, normalizadas pelos valores observados. O bom da métrica MAPE é a sua facilidade de interpretação, já que expressa o erro em termos percentuais, e por ser ``livre de escala'', ou seja, independente da escala dos dados, tornando os resultados comparáveis entre diferentes séries temporais e modelos. Contudo, a MAPE pode ser sensível a valores muito baixos e esta característica deve ser considerada ao interpretar os resultados. Quanto mais próximo de 0, melhor.\cite{hyndman_fpp3_2024b}
	\begin{equation}
		MAPE = \frac{100}{n} \sum_{i=1}^{n} \left| \frac{O_i - P_i}{O_i} \right|
	\end{equation}
	\begin{itemize}
		\item $O_i$ valores observados
		\item $P_i$ valores previstos
		\item $n$ o número total de observações
	\end{itemize}
	
%	\item \textbf{RMSE (\textit{Root Mean Square Error})}: O RMSE mede o erro médio das previsões, penalizando erros maiores devido à sua formulação quadrática. Essa métrica é amplamente utilizada por sua sensibilidade a grandes desvios entre as previsões e os valores observados, o que a torna adequada para identificar erros extremos. O RMSE é uma escolha natural quando se deseja minimizar grandes erros e garantir maior precisão nas previsões. Quanto menor, melhor.\cite{hyndman_fpp3_2024b}
%	\begin{equation}
%		RMSE = \sqrt{\frac{1}{n} \sum_{i=1}^{n} (P_i - O_i)^2}
%	\end{equation}
%	\begin{itemize}
%		\item $O_i$ valores observados
%		\item $P_i$ valores previstos
%		\item $n$ o número total de observações
%	\end{itemize}
	
	%	\item \textbf{$R^2$ (\textit{Coefficient of Determination})}: O Coeficiente de Determinação, que é o quadrado do coeficiente de correlação de Pearson, mede a proporção da variância total nos dados observados que pode ser explicada pelo modelo. Ele varia de $-\inf$ a 1, com valores mais alto indicando uma melhor concordância entre os dados observados e os previstos. Embora o $R^2$ seja amplamente utilizado, ele apresenta limitações que podem resultar em uma avaliação imprecisa do desempenho de modelos hidrológicos, tal como ser uma métrica sensível a valores discrepantes (\textit{outliers}) e avaliar apenas relações lineares. Deve ser empregado com outras métricas para garantir uma boa interpretabilidade dos resultados dos modelos.\cite{legates1999goodness}
	%	\begin{equation}
		%		R^2 = 1 - \frac{\sum_{i=1}^{n} (O_i - {P_i})^2}{\sum_{i=1}^{n} (O_i - \bar{O})^2}
		%	\end{equation}
	%	\begin{itemize}
		%		\item $O_i$ valores observados
		%		\item $P_i$ valores previstos
		%		\item $\bar{O}$ média dos valores observados
		%		\item $n$ o número total de observações
		%	\end{itemize}
	
	\item \textbf{PBIAS (\textit{Percent Bias})}: A PBIAS avalia o viés das previsões, ou seja, a tendência do modelo em superestimar (PBIAS positivo) ou subestimar (PBIAS negativo) os valores observados. Ela expressa a diferença percentual entre a soma dos valores previstos e observados, permitindo identificar se o modelo apresenta uma tendência sistemática de erro. Um valor de PBIAS próximo de zero indica que o modelo não possui viés significativo. Não se espera que esta métrica seja 0, senão indicaria que a previsão foi exatamente o valor observado, mas ao mostrar o viés das previsões, isso tem impacto diretamente nas decisões de gestão de recursos hídricos.\cite{rayyan-33388455}
	\begin{equation}
		PBIAS = 100 \times \frac{\sum_{i=1}^{n} (P_i - O_i)}{\sum_{i=1}^{n} O_i}
	\end{equation}
	\begin{itemize}
		\item $O_i$ valores observados
		\item $P_i$ valores previstos
		\item $n$ o número total de observações
	\end{itemize}
	
	\item \textbf{KGE (\textit{Kling-Gupta Efficiency})}: A KGE fornece uma avaliação integrada do desempenho do modelo, considerando simultaneamente três componentes: correlação, viés e variabilidade relativa entre os valores previstos e observados. A KGE é uma métrica robusta que combina esses três fatores de forma equilibrada, fornecendo um entendimento geral da qualidade das previsões. Essa métrica é especialmente útil em estudos hidrológicos, pois tem capacidade de capturar a complexidade das relações entre variáveis hidrológicas de maneira mais eficaz do que métricas tradicionais focadas em um único aspecto. Quanto mais próximo de 1, melhor o desempenho do modelo.\cite{Gupta2009}
	
	\begin{equation}
		KGE = 1 - \sqrt{(r - 1)^2 + (\alpha - 1)^2 + (\beta - 1)^2}
	\end{equation}
	\begin{itemize}
		\item $r$ é o coeficiente de correlação linear entre os valores observados e previstos 
		\item $\alpha = \frac{\sigma_p}{\sigma_o}$ é a variabilidade relativa, sendo $\sigma_p$ o desvio-padrão das previsões e $\sigma_o$ o desvio-padrão das observações
		\item $\beta = \frac{\mu_p}{\mu_o}$ é o viés, em que $\mu_p$ é a média dos valores previstos e $\mu_o$ a média dos valores observados		
	\end{itemize}
\end{itemize}

Os modelos serão qualificados quanto ao seu desempenho seguindo a seguinte ordem de métricas: 1. KGE, 2. MAPE, 3. PBIAS.

%\section{Treinamento e Validação dos Modelos}
%Detalhar os procedimentos de treinamento e validação dos modelos.

\section{Modelo proposto}
% Detalhar os procedimentos de treinamento e validação dos modelos.

Tudo detalhado até aqui, agora é preciso descrever o fluxo de trabalho. Por fim, será apresentado o fluxograma do modelo proposto para uma rápida depreensão visual.

Primeiramente é necessário especificar o período histórico de análise. Depois de estipulado o período, deve-se identificar as estações de vazão para as quais serão realizadas as previsões.

Identificadas estas estações de vazão, verifica-se em linha reta, em sentido montante da estação de vazão, as estações de precipitação a 50km nas sub-bacias que deságuam no corpo hídrico analisado. Para este passo foi utilizado o programa QGis com \textit{shapefiles} das ottobacias.\cite{snirh_ottobacia_2024} Para o \textit{shapefile} de todas as estações do estado de Minas Gerais foi preciso acesso ao sistema da empresa Rhama Analysis. Sistema fechado este, no caso.

%{\color{red}No passo de verificação dos dados faltantes, o preenchimento foi realizado aplicando a média dos últimos 3 anos para os dias faltantes. O que ainda restou faltando, um modelo kNN finalizou o preenchimento usando os 7 vizinhos mais próximos.} \todo[inline, color = blue, textcolor=white]{já foi dito}

Aqui uma importante etapa: aplicar transformação logarítmica nos dados de vazão e precipitação para tratar o fenômeno de ``cauda longa'' dos dados.

O conjunto teste corresponde aos dados do último ano, 2023, e os demais correspondem ao conjunto treino. Realizar ajuste (`\textit{fit}') e previsão (`\textit{predict}'), dia-a-dia, durante um ano inteiro, para avaliar a qualidade das previsões e a estabilidade dos modelos simulando o uso futuro de um sistema, em que o usuário vai treinar e prever (\textit{fit}/\textit{predict}) diariamente. Este procedimento é referido na literatura como \textit{Walk-Forward Validation} (WFV) e pode ser por uma janela deslizante ou por janela expandida, que foi a técnica aplicada neste trabalho. Além disso, tem duas formas de realizar as previsões: criando vários modelos que irão prever cada um dos dias futuros (`\textit{direct forecasting}'), o que geraria 365 modelos distintos e, consequentemente, consumiria muita mémoria, ou o que foi adotado neste trabalho que foi realizar reajustes (`\textit{refit}') ao modelo inicial num processo recursivo (`\textit{recursive forecasting}'). Esse processo de WFV permite capturar mudanças ao longo do tempo e avaliar a capacidade do modelo de generalizar para o futuro de forma mais realista. Perceba o funcionamento nas imagens a seguir (observação: a fonte de onde as imagens foram retiradas nomeia o processo de Walk-Forward Validation como `\textit{backtesting}' \cite{skforecast_a})

\begin{figure}[!h]
	\centering
	\includegraphics[scale=0.3]{Figuras/skforecast-diagram-backtesting-refit.png}
	\caption{Diagrama mostrando a divisão dos dados de treino/teste com \textit{refit}.\\(fonte: \cite{skforecast_a})}
	\label{fig:skforecast-diagram-backtesting-refit}
\end{figure}

\begin{figure}[!h]
	\centering
	\includegraphics[scale=0.3]{Figuras/imagem1_skforecast-backtesting-refit.png}
	\caption{WFV com janela expandida e \textit{refit} - imagem 1.\\(fonte: \cite{skforecast_a})}
	\label{fig:imagem1_skforecast-backtesting-refit}
\end{figure}

\begin{figure}[!h]
	\centering
	\includegraphics[scale=0.3]{Figuras/imagem2_skforecast-backtesting-refit.png}
	\caption{WFV com janela expandida e \textit{refit} - imagem 2.\\(fonte: \cite{skforecast_a})}
	\label{fig:imagem2_skforecast-backtesting-refit}
\end{figure}

\begin{figure}[!h]
	\centering
	\includegraphics[scale=0.3]{Figuras/imagem3_skforecast-backtesting-refit.png}
	\caption{WFV com janela expandida e \textit{refit} - imagem 3.\\(fonte: \cite{skforecast_a})}
	\label{fig:imagem3_skforecast-backtesting-refit}
\end{figure}

%Com os dados restantes, a saber, de 2013 a 2022, foram realizadas avaliações em alguns horizontes de previsão antes de partir para a análise mais complexa (WFV). A intenção era compreender o comportamento da modelagem em horizontes curtos e médios. Foram escolhidos os horizontes de previsão de 1, 3, 7 e 15 dias. As previsões utilizaram a previsão multietapas, com modelos diretos, ou seja, após feito o ajuste, cada dia foi previsto reiteradamente sem reajuste dos pesos e parâmetros internos dos modelos (``\textit{direct forecast}''). Veja a seguir o procedimento.

%\begin{figure}[!h]
%	\centering
%	\includegraphics[scale=0.3]{Figuras/skforecast-diagram-backtesting-no-refit.png}
%	\caption{Diagrama mostrando a divisão dos dados de treino/teste sem \textit{refit}.\\(fonte: \cite{skforecast_a})}
%	\label{fig:skforecast-diagram-backtesting-no-refit}
%\end{figure}
%
%\begin{figure}[!h]
%	\centering
%	\includegraphics[scale=0.3]{Figuras/imagem1_skforecast-backtesting-no-refit.png}
%	\caption{Previsão multietapas sem reajuste (\textit{refit}) - imagem 1.\\(fonte: \cite{skforecast_a})}
%	\label{fig:imagem1_skforecast-backtesting-no-refit}
%\end{figure}
%
%\begin{figure}[!h]
%	\centering
%	\includegraphics[scale=0.3]{Figuras/imagem2_skforecast-backtesting-no-refit.png}
%	\caption{Previsão multietapas sem reajuste (\textit{refit}) - imagem 2.\\(fonte: \cite{skforecast_a})}
%	\label{fig:imagem2_skforecast-backtesting-no-refit}
%\end{figure}
%
%\begin{figure}[!h]
%	\centering
%	\includegraphics[scale=0.3]{Figuras/imagem3_skforecast-backtesting-no-refit.png}
%	\caption{Previsão multietapas sem reajuste (\textit{refit}) - imagem 3.\\(fonte: \cite{skforecast_a})}
%	\label{fig:imagem3_skforecast-backtesting-no-refit}
%\end{figure}

%Evidentemente que para o horizonte de previsão de 1 dia não há reexecução do modelo, apenas para os outros horizontes.

%Após cada previsão, em cada horizonte proposto, os dados são retornados para a escala original, a transformação log é desfeita. Isso foi realizado para facilitar a leitura e interpretação dos gráficos.

Foram calculados intervalos de previsão (``\textit{prediction intervals}'') de 95\%. A interpretação do intervalo de previsão é: calculados os valores inferior e superior do intervelo de previsão de 95\% (``\textit{lo-95}'' e ``\textit{hi-95}''), o valor real observado futuro tem 95\% de probabilidade de estar dentro destes limites.\cite{hyndman_fpp3_2024a} Apesar de estar sendo usado intervalo de previsão de 95\% na análise, nem sempre o valor real é capturado. Existe uma incerteza quanto à previsão. Esta incerteza advém da própria natureza dos dados hidrológicos e também por assumir que os erros do passado se manterão semelhantes nas previsões. Estes erros são os chamados ``\textit{in sample residuals}'', resíduos das previsões realizadas no passo de treinamento dos dados. É com estes resíduos, que são sorteados da massa de resíduos e geram novas prováveis previsões, que, no final, comporão o cálculo do intervalo de previsão.(figura \ref{fig:diagram-bootstrapping-prediction-intervals})

\begin{figure}[!h]
	\centering
	\includegraphics[scale=0.17]{Figuras/diagram-bootstrapping-prediction-intervals.png}
	\caption{Diagrama de como se calcula o intervalo de previsão.\\(fonte: \cite{skforecast_b})}
	\label{fig:diagram-bootstrapping-prediction-intervals}
\end{figure}


Um fenômeno que pode acontecer é os intervalos de previsão serem estreitos.\cite{RobHyndman_prediction_intervals} Isso porque os modelos não conseguem capturar todos as fontes de incerteza à partir dos dados, a saber:

\begin{itemize}
	\item O termo de erro aleatório
	\item As estimativas dos parâmetros dos modelos
	\item A escolha do modelo para trabalhar os dados históricos
	\item A continuação, no futuro, do processo que gerou os dados históricos
\end{itemize}

Ao produzir intervalos de previsão para modelos de séries temporais, geralmente apenas a primeira dessas fontes é levada em consideração. Portanto, foi criada uma métrica para avaliar a qualidade dos intervalos de previsão, que verificou a cobertura empírica dos intervalos. Não confiou-se apenas na cobertura esperada para os intervalos.

Ficou assim: para cada dia previsto foi feito um teste lógico para verificar se o valor real observado (`y\_true') esteve acima do valor mínimo do intervalo (`lo-95') \textbf{e} abaixo do valor máximo (`hi-95'). Para quando estes dois testes lógicos fossem verdadeiros, adicionava o valor 1 a um vetor, e 0 quando um destes testes lógicos falhasse, ou seja, o `y\_true' estava de algum modo fora do intervalo. Ao final, calculou a média deste vetor e multiplicou por 100 para uma saída percentual. Se o número final fosse 95\% a 100\% então significa que os intervalos de previsão capturaram perfeitamente o valor real futuro. Se abaixo de 95\%, significa que em algum ponto da previsão o valor real ficou para fora destes limites, ou abaixo do valor mínimo ou acima do valor máximo. Veja uma demonstração.

\begin{Verbatim}[frame=single, numbers=left]
	def cobertura_empirica(y, lower_bound, upper_bound):
	media = np.mean(np.logical_and(y >= lower_bound, y <= upper_bound))
	return f"{round(100*media, 2)} %"
\end{Verbatim}

\begin{figure}[!h]
	\centering
	\includegraphics[scale=0.40]{Figuras/intervalo_previsao_1.png}
	\caption{Previsão com valor fora dos limites\\(fonte: o autor)}
	\label{fig:intervalo_previsao_1}
\end{figure}

\begin{figure}[!h]
	\centering
	\includegraphics[scale=0.40]{Figuras/intervalo_previsao_2.png}
	\caption{Previsão completamente nos limites\\(fonte: o autor)}
	\label{fig:intervalo_previsao_2}
\end{figure}

Aplicando a função à figura \ref{fig:intervalo_previsao_1} retornou 42,86\%, os 3 pontos da linha preta, os valores reais observados, de um total de 7. Isso significa que o intervalo de previsão pretendido de 95\% só conseguiu, empiricamente, capturar cerca de 43\% dos valores reais do horizonte de previsão em questão. Na figura \ref{fig:intervalo_previsao_2}, por sua vez, o intervalo capturou 100\% dos valores observados. Ambas figuras mostram previsão de 7 dias, e sem considerar a linha rosa, que foi a previsão que os modelos geraram, o modelo da figura \ref{fig:intervalo_previsao_2} teve um desempenho melhor, segundo essa métrica criada. É mais uma questão a ser considerada quando avaliar a qualidade dos modelos, mas deve ser empregada com parcimônia. Isso porque os intervalos de previsão podem assumir faixas de valores muito elevados. Se por exemplo o modelo calcular intervalos de previsão que vão de 0 $m^3/s$ a 200 mil $m^3/s$, então qualquer valor observado seria capturado, de fato, mas isso não ajudaria em nada na tomada de decisão.

%Em cada resultado será discutido o atraso (\textit{delay}) da série prevista em relação à série original, quando houver, a partir da aplicação do algoritmo FastDTW.\cite{salvador2007toward} \textit{Dynamic Time Warping} (DTW) é uma forma de avaliar a similaridade entre duas sequências quaisquer, neste caso, duas séries temporais: a série temporal dos dados observados e a série temporal dos dados previstos. O algoritmo calcula as distâncias entre os pontos de duas séries esticando e comprimindo-as no eixo do tempo para descobrir o melhor caminho de alinhamento (\textit{warping path}) entre ambas.\cite{dtw_berndt_clifford_1994} No caso aqui utilizado, o algoritmo FastDTW é uma implementação do conceito original de DTW de ordem de complexidade O($n$) que resulta numa aproximação, visto que o algoritmo de DTW é de ordem O($n^2$). Ele escala com a quantidade de dados de entrada, podendo facilmente demandar \textit{terabytes} de memória.\cite{salvador2007toward} Esta análise ajudará a compreender a dinâmica das vazões, fornecendo interpretação sobre quando os eventos passados irão ser percebidos pelos modelos no futuro. E como as análises são na base diária, o resultado do \textit{delay} é a expressão em dias do atraso (\textit{lag}) ou adiantamento (\textit{lead}) de quando um evento (vazão) será percebido pelo modelo e expresso na série gerada por este. Apenas os melhores resultados terão o \textit{delay} discutido.

%Encerrada a discussão do \textit{delay}, procede-se com a análise dos resíduos. Os modelos não-lineares CatBoost e RandomForest não necessitam que haja normalidade, nem para os dados de entrada, nem para os resíduos. Diferentemente do modelo de \textit{Linear Regression}, em que é necessário realizar tal avaliação em busca de compreender o funcionamento do modelo.

Encerrada essa etapa, procede-se com a análise dos resíduos. Os modelos não-lineares CatBoost e RandomForest não necessitam que haja normalidade, nem para os dados de entrada, nem para os resíduos. Diferentemente do modelo de \textit{Linear Regression}, em que é necessário realizar tal avaliação em busca de compreender o funcionamento do modelo.

Analisar os resíduos permite verificar a estabilidade do modelo quanto às previsões. Uma distribuição normal dos resíduos é um indício de que os coeficientes do modelo conseguiram capturar as relações temporais dos dados de entrada. Além disso, analisar os resíduos permite avaliar se o modelo assumiu uma correta relação entre a variável alvo e as variáveis independentes.\cite{belloto1985residual}

%A última análise é avaliação da importância das variáveis. Como na análise de \textit{delay}, \underline{apenas os melhores resultados} serão analisados de cada modelo. Serão apresentados os valores SHAP das variáveis dos modelos e discussão sobre o comportamento de cada uma delas para a qualidade dos modelos.

A última análise é avaliação da importância das variáveis. \underline{Apenas os melhores resultados} serão analisados de cada modelo. Serão apresentados os valores SHAP das variáveis dos modelos e discussão sobre o comportamento de cada uma delas para a qualidade dos modelos.

\textit{SHAP values} (\textit{SHapley Additive exPlanations}) constituem uma metodologia robusta, derivada da teoria dos jogos cooperativos, com o propósito de elucidar o funcionamento de modelos de aprendizado de máquina, frequentemente caracterizados como ``caixas pretas''. A premissa fundamental reside na atribuição de um valor a cada característica preditiva, quantificando sua contribuição individual para a predição final do modelo, considerando todas as interações possíveis com demais características. Essa abordagem viabiliza a compreensão dos fatores determinantes na tomada de decisão do modelo e como cada um impacta o resultado, seja de forma positiva ou negativa, promovendo assim a interpretabilidade e transparência.\cite{merrick_taly_2020}

Não consta no fluxograma do modelo proposto, mas para todos os modelos teve também uma rodada de execução com os dados originais \underline{sem transformação logarítmica}, apenas havendo aplicação de escalonamento de dados usando MinMax para o LinearRegression. Mas isso é obrigatório para este tipo de modelo pois a escala dos dados é muito discrepante, com vazão em $m^3/s$ e precipitação em $mm/dia$. Contudo, o escalonamento não modifica a distribuição dos dados, mantendo o mesmo comportamento dos dados originais. Essa característica é importante. Todas as comparações serão importantes para chegar em uma melhor interpretação dos fenômenos e dar direcionamentos sobre quais modelos e como utilizar os modelos pensando em termos de gestão dos recursos hídricos.

%Antes, porém, foi realizada uma busca de hiperpâmetros nos modelos LightGBM e CatBoost. A busca de hiperparâmetros visa otimizar o desempenho dos modelos ao encontrar a melhor combinação de hiperparâmetros, adequadamente ajustados aos dados. Este processo foi realizado utilizando o \textit{framework} Optuna e validação-cruzada dividindo os dados de 10 anos (2013 a 2022) em 10 segmentos (\textit{folds}).\cite{akiba2019optuna}\cite{optuna_docs}\cite{skforecast}

%Com os melhores hiperparâmetros encontrados, aí sim procedeu-se para a última etapa da análise: aplicar Walk-Forward Validation.

O ambiente computacional em que os experimentos foram executados é:

\begin{table}[!h]
	\centering \small
	\caption{Configurações do computador usado nos experimentos\\(fonte: o autor)}
	\begin{tabular}{|l|l|} \hline 
		\textbf{Configuração} & \textbf{Descrição} \\\hline
		CPU                   & Ryzen 7 5700 (8 núcleos/16 \textit{threads}) \\\hline
		GPU                   & RTX 3060                                     \\\hline
		Memória RAM           & 32 GB 3200MHz                                \\\hline
		Disco                 & SSD NVMe                                     \\\hline
		Kernel                & Linux 6.8.0-40-generic                       \\\hline
		Python                & versão 3.9.18                                \\\hline
	\end{tabular}
	\label{tab:config_pc}
\end{table}

Os resultados serão apresentados no \hyperref[cap:capitulo4]{capítulo 4}.
\clearpage

\begin{figure}[!h]
	\centering
	\includegraphics[scale=0.4]{Figuras/flowchart.png}
	\caption{Fluxo de trabalho\\(fonte: o autor)}
	\label{fig:fluxo_trabalho}
\end{figure}